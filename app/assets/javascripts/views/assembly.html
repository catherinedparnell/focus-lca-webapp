<div id="assembly-page" layout="row" layout-fill dnd-list="[]" style="list-style: none;">
    <div layout="column" style="background-color: #eeeeee;" flex>

        <!-- Assembly Toolbar -->
        <md-toolbar id="assembly-toolbar" class="md-menu-toolbar">
            <div layout="row" layout-align="space-between start">
                <div>
                    <h2 class="md-toolbar-tools">Library</h2>
                </div>
                <div>
                    <h2 class="md-toolbar-tools" ng-hide="editName">
                        {{assembly.name}}
                        <md-button class="md-icon-button test-tooltip" aria-label="Refresh" style="margin-left: 5px;" ng-click="editName = !editName">
                            <md-tooltip md-direction="up">Edit name</md-tooltip>
                            <md-icon aria-label="Edit" class="material-icons">edit</md-icon>
                        </md-button>
                    </h2>
                    <h2 class="md-toolbar-tools" ng-show="editName">
                        <md-input-container class="md-block" ng-show="editName">
                            <input required md-no-asterisk name="name" ng-model="assembly.name" aria-label="Input Name">
                            <div ng-messages="projectForm.name.$error">
                                <div ng-message="required">This is required.</div>
                                <div ng-message="md-maxlength">The description must be less than 20 characters long.</div>
                            </div>
                        </md-input-container>
                        <md-button class="md-icon-button test-tooltip" aria-label="Refresh" style="margin-left: 5px;" ng-click="(assembly.name.length > 0) ? (editName = !editName) : (editName = editName)">
                            <md-icon aria-label="Check" class="material-icons">check</md-icon>
                        </md-button>
                    </h2>
                </div>
                <div>
                    <h2 class="md-toolbar-tools">
                        <md-button class="md-icon-button test-tooltip" aria-label="Add Subassembly" ng-click="addSubassembly()">
                            <md-tooltip md-direction="up">Add subassembly</md-tooltip>
                            <md-icon aria-label="Create New Folder" class="material-icons">create_new_folder</md-icon>
                        </md-button>
                        <md-button class="md-icon-button test-tooltip" aria-label="Analyze" ng-click="showAnalyze($event)">
                            <md-tooltip md-direction="up">Analyze</md-tooltip>
                            <md-icon aria-label="Insert Chart" class="material-icons">insert_chart</md-icon>
                        </md-button>
                        <md-button class="md-icon-button test-tooltip" aria-label="Save" ng-click="saveAssembly()">
                            <md-tooltip md-direction="up">Save</md-tooltip>
                            <md-icon aria-label="Save" class="material-icons">save</md-icon>
                        </md-button>
                    </h2>
                </div>
            </div>
        </md-toolbar>

        <!-- Main div -->
        <div layout="row" flex>

            <!-- Left sidebar -->
            <div id="assembly-sidebar" resizable r-directions="['right']" r-grabber="{{customGrabber}}"><!-- ng-scrollbars ng-scrollbars-config="configScrollbar" -->
                <div style="height: 100%;" ng-scrollbars ng-scrollbars-config="configScrollbar">
                    <md-expansion-panel-group md-component-id="panelGroup" multiple style="padding: 5px;">
                        <md-expansion-panel ng-repeat="element in library" md-component-id="panel + element" style="margin-left: 10px; margin-right: 10px">
                            <md-expansion-panel-collapsed style="cursor:pointer">
                                <div class="md-title">{{element}}</div>
                                <div class="md-summary"></div>
                                <md-expansion-panel-icon></md-expansion-panel-icon>
                            </md-expansion-panel-collapsed>
                            <md-expansion-panel-expanded>
                                <md-expansion-panel-header ng-click="$panel.collapse()">
                                    <div class="md-title">{{element}}</div>
                                    <div class="md-summary"></div>
                                    <md-expansion-panel-icon></md-expansion-panel-icon>
                                </md-expansion-panel-header>
                                <md-expansion-panel-content style="padding: 0;">
                                    <md-list>
                                        <md-list-item style="cursor:move" ng-repeat="material in data" dnd-draggable="initDraggable(material)" dnd-effect-allowed="copy">
                                            <span>{{material}}</span>
                                            <md-divider ng-if="!$last"></md-divider>
                                        </md-list-item>
                                    </md-list>
                                </md-expansion-panel-content>
                            </md-expansion-panel-expanded>
                        </md-expansion-panel>
                    </md-expansion-panel-group>
                </div>
            </div>

            <!-- Assembly Canvas -->
            <div id="assembly-canvas" ng-scrollbars ng-scrollbars-config="configScrollbar" flex>
                <md-card class="page" style="padding: 15px;">
                    <div ng-repeat="(zone, list) in models.dropzones">
                        <div class="dropzone box box-yellow">
                            <!-- The dropzone also uses the list template -->
                            <div ng-include="'list.html'"></div>
                        </div>
                    </div>
                </md-card>

                <div view-source="nested"></div>
            </div>
        </div>
    </div>
    <!--Main area with dropzones and source code -->
    <!--<div>-->
        <!--<h2>Generated Model</h2>-->
        <!--<pre>{{modelAsJson}}</pre>-->
    <!--</div>-->
</div>

<!-- ############################################################################# -->
<!-- ############ Templates definitions for the drag and drop library ############ -->
<!-- ############################################################################# -->

<script type="text/ng-template" id="list.html">
    <ul dnd-list="list" style="height: 100%; padding-left: 0; list-style: none;">
        <md-card ng-repeat="item in list"
                 dnd-draggable="item"
                 dnd-effect-allowed="move"
                 dnd-moved="list.splice($index, 1)"
                 dnd-selected="models.selected = item"
                 ng-class="{selected: models.selected === item}"
                 ng-include="item.type + '.html'">
        </md-card>
    </ul>
</script>

<!-- This template is responsible for rendering a container element. It uses
     the above list template to render each container column -->
<script type="text/ng-template" id="subassembly.html">
    <div class="container-element box box-blue">
        <md-toolbar class="md-hue-2">
            <div class="md-toolbar-tools">
                <h2 flex md-truncate>{{item.name}}</h2>
            </div>
        </md-toolbar>
        <div class="column" ng-repeat="list in item.columns" ng-include="'list.html'"></div>
        <div class="clearfix"></div>
    </div>
</script>

<!-- Template for a normal list item -->
<script type="text/ng-template" id="material.html">
    <div class="item">{{item.name}}</div>
</script>